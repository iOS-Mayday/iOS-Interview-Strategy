2015 å¹´ WWDCï¼Œè‹¹æœç¬¬ä¸€æ¬¡æå‡ºäº† Swift çš„é¢å‘åè®®ç¼–ç¨‹ï¼ˆProtocol Oriented Programmingï¼Œä»¥ä¸‹ç®€ç§° POP ï¼‰ï¼Œè¿™æ˜¯è®¡ç®—æœºå†å²ä¸Šä¸€ä¸ªå…¨æ–°çš„ç¼–ç¨‹èŒƒå¼ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œç›¸å¯¹åº”çš„é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ï¼ˆObject Oriented Programmingï¼Œä»¥ä¸‹ç®€ç§° OOP ï¼‰å·²ç»å¤§è¡Œå…¶é“ 50 å¹´ï¼Œå®ƒå‡ ä¹å®Œç¾çš„è§£å†³å‡½æ•°å¼ç¼–ç¨‹ï¼ˆFunctional Programmingï¼‰çš„ç¼ºç‚¹ï¼Œå¹¶ä¸”å‡ºç°åœ¨ä»å¤§å‹ç³»ç»Ÿåˆ°å°å‹åº”ç”¨ã€ä»æœåŠ¡å™¨ç«¯åˆ°å‰ç«¯çš„å„ä¸ªæ–¹é¢ã€‚å®ƒçš„ä¼˜ç‚¹è¢«æ— æ•°ç¨‹åºå‘˜ç§°é¢‚ï¼Œå®ƒè§£å†³äº†è¯¸å¤šå¼€å‘ä¸­çš„å¤§å°é—®é¢˜ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ—¢ç„¶ OOP å¦‚æ­¤ä¸‡èƒ½ï¼Œä¸ºä»€ä¹ˆ Swift è¦å¼„å‡ºå…¨æ–°çš„ POP ï¼Ÿ

![](https://upload-images.jianshu.io/upload_images/22877992-e59c370779cad098.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç¬”è€…è®¤ä¸ºï¼ŒåŸå› æœ‰ä¸‰ã€‚å…¶ä¸€ï¼ŒOOP æœ‰è‡ªèº«çš„ç¼ºç‚¹ã€‚åœ¨ç»§æ‰¿ã€ä»£ç å¤ç”¨ç­‰æ–¹é¢ï¼Œå…¶çµæ´»åº¦ä¸é«˜ã€‚è€Œ POP æ°å¥½å¯ä»¥ä¼˜é›…å¾—è§£å†³è¿™äº›é—®é¢˜ï¼›å…¶äºŒï¼ŒPOP å¯ä»¥ä¿è¯ Swift ä½œä¸ºé™æ€è¯­è¨€çš„å®‰å…¨æ€§ï¼Œè€Œå½¼æ—¶ Objective-C æ—¶ä»£çš„ OOPï¼Œå…¶åŠ¨æ€ç‰¹æ€§ç»å¸¸ä¼šå¯¼è‡´å¼‚å¸¸ï¼›å…¶ä¸‰ï¼ŒOOP æ— æ³•åº”ç”¨äºå€¼ç±»å‹ï¼Œè€Œ POP å´å¯ä»¥å°†å…¶ä¼˜åŠ¿æ‹“å±•åˆ°ç»“æ„ä½“ï¼ˆstructï¼‰å’Œæšä¸¾ï¼ˆenumï¼‰ç±»å‹ä¸Šã€‚

æœ¬èŠ‚å°†é€šè¿‡é—®é¢˜ä¸²è”çš„å½¢å¼ï¼Œè¯´æ˜ POP ç›¸æ¯”äº OOP çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶å±•ç¤º POP åœ¨å®é™…å¼€å‘ä¸­çš„è¿ç”¨ã€‚

## POP vs OOP

### 1.ä»€ä¹ˆæ˜¯ OOP ï¼Ÿå®ƒåœ¨ iOS å¼€å‘ä¸­æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ

**å…³é”®è¯ï¼š#é¢å‘å¯¹è±¡ç¼–ç¨‹**

OOP å…¨ç§°æ˜¯ Object Oriented Programmingï¼Œå³é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ï¼Œæ˜¯ç›®å‰æœ€ä¸»æµçš„ç¼–ç¨‹èŒƒå¼ã€‚åœ¨ iOS å¼€å‘ä¸­ï¼Œç»å¤§å¤šæ•°çš„éƒ¨åˆ†è¿ç”¨çš„éƒ½æ˜¯ OOPã€‚

åœ¨ iOS å¼€å‘ä¸­ï¼Œå®ƒæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š

*   **å°è£…å’Œæƒé™æ§åˆ¶ã€‚**ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•è¢«æ”¾å…¥ä¸€ä¸ªç±»ä¸­ï¼ŒObjective-C ä¸­ ".h" æ–‡ä»¶è´Ÿè´£å£°æ˜å…¬å…±å˜é‡å’Œæ–¹æ³•ï¼Œ".m" æ–‡ä»¶è´Ÿè´£å£°æ˜ç§æœ‰å˜é‡ï¼Œå¹¶å®ç°æ‰€æœ‰æ–¹æ³•ã€‚Swift ä¸­ä¹Ÿæœ‰ public/internal/fileprivate/private ç­‰æƒé™æ§åˆ¶ã€‚

*   **å‘½åç©ºé—´ã€‚**åœ¨ Swift ä¸­ï¼Œä¸åŒçš„ class å³ä½¿å‘½åç›¸åŒï¼Œåœ¨ä¸åŒçš„ bundle ä¸­ç”±äºå‘½åç©ºé—´ä¸åŒï¼Œå®ƒä»¬ä¾ç„¶å¯ä»¥å’Œè°å…±å­˜æ¯«æ— å†²çªã€‚è¿™åœ¨ App å¾ˆå¤§ã€bundle å¾ˆå¤šçš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ã€‚Objective-C æ²¡æœ‰å‘½åç©ºé—´ï¼Œæ‰€ä»¥å¾ˆå¤šç±»åœ¨å‘½åæ—¶éƒ½åŠ å…¥äº†é©¼å³°å¼çš„å‰ç¼€ã€‚

*   **æ‰©å±•æ€§ã€‚**åœ¨ Swift ä¸­ï¼Œclass å¯ä»¥é€šè¿‡ extension æ¥è¿›è¡Œå¢åŠ æ–°æ–¹æ³•ï¼Œé€šè¿‡åŠ¨æ€ç‰¹æ€§äº¦å¯ä»¥å¢åŠ æ–°å˜é‡ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥ä¿è¯åœ¨ä¸ç ´ååŸæ¥ä»£ç å°è£…çš„æƒ…å†µä¸‹å®ç°æ–°çš„åŠŸèƒ½ã€‚Objective-C ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ category æ¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚å¦å¤–ï¼ŒSwift å’Œ Objective-C ä¸­è¿˜å¯ä»¥é€šè¿‡ protocol å’Œä»£ç†æ¨¡å¼æ¥å®ç°æ›´åŠ çµæ´»çš„æ‰©å±•ã€‚

*   **ç»§æ‰¿å’Œå¤šæ€ã€‚**åŒå…¶ä»–è¯­è¨€ä¸€æ ·ï¼ŒiOS å¼€å‘ä¸­æˆ‘ä»¬å¯ä»¥å°†å…±åŒçš„æ–¹æ³•å’Œå˜é‡å®šä¹‰åœ¨çˆ¶ç±»ä¸­ï¼Œåœ¨å­ç±»ç»§æ‰¿æ—¶å†å„è‡ªå®ç°å¯¹åº”åŠŸèƒ½ï¼Œåšåˆ°ä»£ç å¤ç”¨çš„é«˜æ•ˆè¿ä½œã€‚åŒæ—¶é’ˆå¯¹ä¸åŒæƒ…å†µå¯ä»¥è°ƒç”¨ä¸åŒå­ç±»ï¼Œå¤§å¤§å¢åŠ ä»£ç çš„çµæ´»æ€§ã€‚

å¦‚æœä½ æ­£åœ¨è·³æ§½æˆ–è€…æ­£å‡†å¤‡è·³æ§½ä¸å¦¨åŠ¨åŠ¨å°æ‰‹ï¼Œæ·»åŠ ä¸€ä¸‹å’±ä»¬çš„äº¤æµç¾¤[**101 295 1431**](https://jq.qq.com/?_wv=1027&k=SSQAVXir)æ¥è·å–ä¸€ä»½è¯¦ç»†çš„å¤§å‚é¢è¯•èµ„æ–™ä¸ºä½ çš„è·³æ§½å¤šæ·»ä¸€ä»½ä¿éšœã€‚


### 2.è¯·è°ˆè°ˆ OOP åœ¨ iOS å¼€å‘ä¸­çš„ç¼ºç‚¹

**å…³é”®è¯ï¼š#å†…å­˜ #ç»§æ‰¿**

ä¸€èˆ¬é¢è¯•å®˜è¿™æ ·é—®ï¼Œæˆ‘ä»¬ä¸ä»…è¦å›ç­”å‡ºç¼ºç‚¹ï¼Œè¿˜è¦è¯´å‡ºä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆã€‚ä¸€ä¸ªä¸“ä¸šçš„ç¨‹åºå‘˜ä¸ä»…è¦çŸ¥é“é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Œæ›´è¦çŸ¥é“è¯¥æ€ä¹ˆä¿®æ­£é—®é¢˜ã€‚

OOP æœ‰ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š

*   **éšå¼å…±äº«ã€‚**class æ˜¯å¼•ç”¨ç±»å‹ï¼Œåœ¨ä»£ç ä¸­æŸå¤„æ”¹å˜æŸä¸ªå®ä¾‹å˜é‡çš„æ—¶å€™ï¼Œå¦ä¸€å¤„åœ¨è°ƒç”¨æ­¤å˜é‡æ—¶å°±ä¼šå—æ­¤ä¿®æ”¹å½±å“ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```
class People { var name = â€œâ€}
// åˆ›å»ºå¼ ä¸‰ï¼Œè®¾ç½®å…¶åå­—ä¸ºå¼ ä¸‰
let zhangSan = People()
zhangSan.name = â€œå¼ ä¸‰â€

// åˆ›å»ºæå››ï¼Œè®¾ç½®å…¶åå­—ä¸ºæå››
let liSi = zhangSan
Lisi.name = â€œæå››â€

print(zhangSan.name) // æå››
print(Lisi.name) // æå››

```

è¿™å¾ˆå®¹æ˜“å°±é€ æˆå¼‚å¸¸ã€‚å°¤å…¶æ˜¯åœ¨å¤šçº¿ç¨‹æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°çš„èµ„æºç«é€Ÿï¼ˆRace Conditionï¼‰å°±æ˜¯è¿™ä¸ªæƒ…å†µã€‚è§£å†³æ–¹æ¡ˆæ˜¯åœ¨å¤šçº¿ç¨‹æ—¶æ·é”ï¼Œå½“ç„¶è¿™ä¸ªæ–¹æ¡ˆä¼šå¼•å…¥æ­»é”å’Œä»£ç å¤æ‚åº¦å‰§å¢çš„é—®é¢˜ã€‚æœ€å¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜æ˜¯å°½å¯èƒ½ç”¨è¯¸å¦‚ struct è¿™æ ·çš„å€¼ç±»å‹å–ä»£ classã€‚

*   **å†—æ‚çš„çˆ¶ç±»ã€‚**è¯•æƒ³è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œä¸€ä¸ª UIViewController çš„å­ç±»å’Œä¸€ä¸ª UITableViewController ä¸­éƒ½éœ€è¦åŠ å…¥ handleSomething() è¿™ç§æ–¹æ³•ã€‚OOP çš„è§£å†³æ–¹æ¡ˆæ˜¯ç›´æ¥åœ¨ UIViewController çš„ extension ä¸­åŠ å…¥ handleSomething()ã€‚ä½†æ˜¯éšç€æ–°æ–¹æ³•è¶ŠåŠ è¶Šå¤šï¼Œä»¥å UIVIewController ä¼šè¶Šå˜è¶Šå†—æ‚ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼•å…¥ä¸€ä¸ªä¸“é—¨çš„çˆ¶ç±»æˆ–å·¥å…·ç±»ï¼Œä½†æ˜¯ä¾ç„¶æœ‰èŒæƒä¸æ˜ç¡®ã€ä¾èµ–ã€å†—æ‚ç­‰å¤šç§é—®é¢˜ã€‚

    å¦ä¸€æ–¹é¢ï¼Œçˆ¶ç±»ä¸­çš„ handleSomething() æ–¹æ³•å¿…é¡»ç”±å…·ä½“å®ç°ï¼Œå®ƒä¸èƒ½æ ¹æ®å­ç±»åšå‡ºçµæ´»è°ƒæ•´ã€‚å­ç±»å¦‚æœè¦åšç‰¹å®šæ“ä½œï¼Œå¿…é¡»è¦é‡å†™æ–¹æ³•æ¥å®ç°ã€‚æ—¢ç„¶å­ç±»è¦é‡å†™ï¼Œé‚£ä¹ˆåœ¨çˆ¶ç±»ä¸­çš„å®ç°åœ¨è¿™ç§æ—¶å€™å°±æ˜¾å¾—å¤šæ­¤ä¸€ä¸¾ã€‚è§£å†³æ–¹æ¡ˆä½¿ç”¨ protocolï¼Œè¿™æ ·å®ƒçš„æ–¹æ³•å°±ä¸éœ€è¦ç”¨å…·ä½“å®ç°äº†ï¼Œäº¤ç»™æœä»å®ƒçš„ç±»æˆ–ç»“æ„ä½“å³å¯ã€‚

*   **å¤šç»§æ‰¿ã€‚**Â Swift å’Œ Objective-C æ˜¯ä¸æ”¯æŒå¤šç»§æ‰¿çš„ï¼Œå› ä¸ºè¿™ä¼šé€ æˆè±å½¢é—®é¢˜ï¼Œå³å¤šä¸ªçˆ¶ç±»å®ç°äº†åŒä¸€ä¸ªæ–¹æ³•ï¼Œå­ç±»æ— æ³•åˆ¤æ–­ç»§æ‰¿å“ªä¸ªçˆ¶ç±»çš„æƒ…å†µã€‚åœ¨ Java ä¸­ï¼Œæœ‰ interface çš„è§£å†³æ–¹æ¡ˆï¼ŒSwift ä¸­æœ‰ç±»ä¼¼ protocol çš„è§£å†³æ–¹æ¡ˆã€‚

### 2.è¯´è¯´ POP ç›¸æ¯”äº OOP çš„ä¼˜åŠ¿

**å…³é”®è¯ï¼š#çµæ´» #å®‰å…¨**

è¿™é“é¢˜æ˜¯ä¸€ä¸ªå¼€æ”¾æ€§çš„é—®é¢˜ã€‚åœ¨é¢è¯•ä¸­ä¸€ä¸ªå¾ˆå¥½çš„å›ç­”æ–¹å¼æ˜¯ç†è®º+ä¸¾ä¾‹ã€‚POP ç›¸æ¯” OOP å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ã€‚

*   **æ›´åŠ çµæ´»ã€‚**æ¯”å¦‚ä¸Šé¢˜ä¸­æˆ‘ä»¬æåˆ°çš„å†—æ‚çš„çˆ¶ç±»çš„ä¾‹å­ã€‚æˆ‘ä»¬å¯ä»¥ç”¨åè®®å’Œå…¶æ‰©å±•æ¥è®©æ‰€æœ‰æœä»æ­¤åè®®çš„ class éƒ½å¯ä»¥ç”¨åˆ°é»˜è®¤çš„ handleSomething() æ–¹æ³•ï¼ŒåŒæ—¶æœä»äº†è¯¥åè®®çš„åŒæ—¶ä¹Ÿå¢åŠ äº†ä»£ç çš„å¯è¯»æ€§ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```
protocol SomethingHandleable {
  func handleSomething()
}

extension SomethingHandleable {
  func handleSomething() {
    // å®ç°
  }
} 

class ViewController: UIViewController, SomethingHandleable { }
class TableViewController: UITableViewController, SomethingHandleable { }

```

*   **å‡å°‘ä¾èµ–ã€‚**ç›¸å¯¹äºä¼ å…¥å…·ä½“çš„å®ä¾‹å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ protocol æ¥å®ç°å¤šæ€ã€‚åŒæ—¶æµ‹è¯•æ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨ protocol æ¥ mock çœŸå®çš„å®ä¾‹ï¼Œå‡å°‘å¯¹äºå¯¹è±¡åŠå…¶å®ç°çš„ä¾èµ–ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªå®ä¾‹ï¼š

å¦‚æœä½ æ­£åœ¨è·³æ§½æˆ–è€…æ­£å‡†å¤‡è·³æ§½ä¸å¦¨åŠ¨åŠ¨å°æ‰‹ï¼Œæ·»åŠ ä¸€ä¸‹å’±ä»¬çš„äº¤æµç¾¤[**101 295 1431**](https://jq.qq.com/?_wv=1027&k=SSQAVXir)æ¥è·å–ä¸€ä»½è¯¦ç»†çš„å¤§å‚é¢è¯•èµ„æ–™ä¸ºä½ çš„è·³æ§½å¤šæ·»ä¸€ä»½ä¿éšœã€‚


```
protocol Request {
  func send(request: Info)
}

protocol Info {}

class UserRequest: Request {
  // æ³¨æ„è¿™é‡Œæˆ‘ä»¬ä¼ å…¥äº†Infoè¿™ä¸ªprotocolï¼Œå®ƒæ— éœ€æ˜¯å…·ä½“çš„UserInfoï¼Œè¿™æ–¹ä¾¿äº†æˆ‘ä»¬ä¹‹åæµ‹è¯•å’Œæ‰©å±•
  func send(info: Info) {
    // å®é™…å®ç°ï¼Œä¸€èˆ¬æ˜¯æŠŠinfoå‘ç»™server
  }
}

class UserInfo: Info {}

class MockUserRequest: Request {
  func send(info: Info) { // è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä¸ºæµ‹è¯•æ–¹ä¾¿æ¥è‡ªå®šä¹‰å®ç° }
}

func testUserRequest() {
  let userRequest = MockUserRequest()
  userRequest.send(info: UserInfo())
}

```

*   **æ¶ˆé™¤åŠ¨æ€åˆ†å‘çš„é£é™©ã€‚**å¯¹äºæœä»äº† protocol çš„ç±»æˆ–ç»“æ„ä½“æ¥è¯´ï¼Œå®ƒå¿…é¡»å®ç° protocol å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ã€‚å¦åˆ™ç¼–è¯‘æ—¶å°±ä¼šæŠ¥é”™ï¼Œè¿™æ ¹æœ¬ä¸Šæœç»äº† runtime æ—¶ç¨‹åºçš„é£é™©ï¼Œä¸‹é¢å°±æ˜¯ POP å’Œ OOP åœ¨åŠ¨æ€æ´¾å‘æ—¶çš„å¯¹æ¯”ï¼š

```
// Objective-Cä¸‹åŠ¨æ€æ´¾å‘runtimeæŠ¥é”™å®ä¾‹
ViewController *vc = ...
[vc handleSomething];

TableViewController *tvc = ...
[tvc handleSomething];

NSObject *ob = ... // ob æ²¡æœ‰å®ç°handleSomething
NSArray *array = @[vc, tvc, ob];
for (id obj in array) { 
  [obj handleSomething]; // èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†è¿è¡Œåˆ°obæ—¶ç¨‹åºä¼šå´©æºƒ
}

// Swiftä¸­ä½¿ç”¨äº†POP
let vc = ...
let tvc = ...
let ob = ...

let array: [SomethingHandleable] = [vc, tvc, ob] // è¿™é‡Œç›´æ¥ä¼šæŠ¥é”™ï¼Œå› ä¸ºobæ²¡æœ‰å®ç°SomethingHandleableåè®®

```

*   **åè®®å¯ä»¥ç”¨äºå€¼ç±»å‹ã€‚**ç›¸æ¯”äº OOP åªèƒ½ç”¨äº classï¼ŒPOP å¯ä»¥ç”¨äº struct å’Œ enum è¿™æ ·çš„å€¼ç±»å‹ä¸Šã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```
protocol Flyable { }

protocol Bird {
  var name: String { get }
  var canFly: Bool { get }
}

extension Bird {
  var canFly: Bool { return self is Flyable }
}

struct ButterFly: Flyable {}

struct Penguin: Bird {
  var name = "Penguin"
}

struct Eagle: Bird, Flyable {
  var name = â€œEagleâ€
}

enum FlyablePokemon: Flyable {
  case Pidgey
  case Duduo
}

```

## POP é¢è¯•å®æˆ˜

å¦‚æœä½ æ­£åœ¨è·³æ§½æˆ–è€…æ­£å‡†å¤‡è·³æ§½ä¸å¦¨åŠ¨åŠ¨å°æ‰‹ï¼Œæ·»åŠ ä¸€ä¸‹å’±ä»¬çš„äº¤æµç¾¤[**101 295 1431**](https://jq.qq.com/?_wv=1027&k=SSQAVXir)æ¥è·å–ä¸€ä»½è¯¦ç»†çš„å¤§å‚é¢è¯•èµ„æ–™ä¸ºä½ çš„è·³æ§½å¤šæ·»ä¸€ä»½ä¿éšœã€‚


### 4.è¦ç»™ä¸€ä¸ª UIButton å¢åŠ ä¸€ä¸ªç‚¹å‡»åæŠ–åŠ¨çš„æ•ˆæœï¼Œè¯¥æ€æ ·å®ç°ï¼Ÿ

**å…³é”®è¯ï¼š#æ‰©å±• #åè®®**

è§£å†³æ–¹æ¡ˆæœ‰ä¸‰ç§ã€‚ä¸ªäººæ¨èç”¨ protocol æ¥è§£å†³ã€‚

*   å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ UIButton ç±»ï¼Œåœ¨å…¶ä¸­æ·»åŠ ç‚¹å‡»æŠ–åŠ¨æ•ˆæœçš„æ–¹æ³•ï¼ˆshake æ–¹æ³•ï¼‰;

*   å†™ä¸€ä¸ª UIButton æˆ–è€… UIView çš„æ‹“å±•ï¼ˆextensionï¼‰ï¼Œç„¶ååœ¨å…¶ä¸­å¢åŠ  shake æ–¹æ³•;

*   å®šä¹‰ä¸€ä¸ª protocolï¼Œç„¶ååœ¨åè®®æ‰©å±•ï¼ˆprotocol extensionï¼‰ä¸­æ·»åŠ  shake æ–¹æ³•;

åˆ†æè¿™ä¸‰ç§æ–¹æ³•ï¼š

*   åœ¨è‡ªå®šä¹‰çš„ç±»ä¸­æ·»åŠ  shake æ–¹æ³•æ‰©å±•æ€§ä¸å¥½ã€‚å¦‚æœ shake æ–¹æ³•è¢«ç”¨åœ¨å…¶ä»–åœ°æ–¹ï¼Œåˆè¦åœ¨å…¶ä»–ç±»ä¸­å†æ·»åŠ ä¸€é shake æ–¹æ³•ï¼Œè¿™æ ·ä»£ç å¤ç”¨æ€§å·®ã€‚

*   åœ¨ extension ä¸­å®ç°è™½ç„¶è§£å†³äº†ä»£ç å¤ç”¨æ€§é—®é¢˜ï¼Œä½†æ˜¯å¯è¯»æ€§æ¯”è¾ƒå·®ã€‚å›¢é˜Ÿå¼€å‘ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰äººéƒ½çŸ¥é“è¿™ä¸ª extension ä¸­å­˜åœ¨ shake æ–¹æ³•ï¼ŒåŒæ—¶éšç€åŠŸèƒ½çš„æ‰©å±•ï¼Œextension ä¸­æ–°å¢çš„æ–¹æ³•ä¼šå±‚å‡ºä¸ç©·ï¼Œå®ƒä»¬å¾ˆéš¾å½’ç±»ç®¡ç†ã€‚

*   ç”¨åè®®å®šä¹‰è§£å†³äº†å¤ç”¨æ€§ã€å¯è¯»æ€§ã€ç»´æŠ¤æ€§ä¸‰ä¸ªéš¾é¢˜ã€‚åè®®çš„å‘½åï¼ˆä¾‹å¦‚ Shakeableï¼‰ç›´æ¥å¯ä»¥ç¡®å®šå…¶å®ç°çš„ UIButton æ‹¥æœ‰ç›¸åº” shake åŠŸèƒ½ï¼›é€šè¿‡åè®®æ‰©å±•ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒç±»å®ç°ç‰¹å®šçš„æ–¹æ³•ï¼Œå¯ç»´æŠ¤æ€§ä¹Ÿå¤§å¤§æé«˜ï¼›å› ä¸ºåè®®æ‰©å±•é€šç”¨äºæ‰€æœ‰å®ç°å¯¹è±¡ï¼Œæ‰€ä»¥ä»£ç å¤ç”¨æ€§ä¹Ÿå¾ˆé«˜ã€‚

### 5.ä¼˜åŒ–ä»¥ä¸‹ä»£ç 

**å…³é”®è¯ï¼š#Self #å…³è”ç±»å‹**

```
protocol Food {}
struct Fish: Food {}
struct Bone: Food {}

protocol Animal {
  func eat(food: Food)
  func greet(other: Animal)
}

struct Cat: Animal {
  func eat(food: Food) {
    guard let _ = food as? Fish else {
      print("çŒ«åªåƒé±¼!")
      return
    }
  }

  func greet(other: Animal) {
    if let _ = other as? Cat {
      print("å–µ~")
    } else {
      print("çŒ«å¾ˆå‚²å¨‡ï¼Œä¸ä¼šå¯¹å…¶ä»–åŠ¨ç‰©æ‰“æ‹›å‘¼!")
    }
  }
}

struct Dog: Animal {
  func eat(food: Food) {
    guard let _ = food as? Bone else {
      print("ç‹—åªå•ƒéª¨å¤´!")
      return
    }
  }

  func greet(other: Animal) {
    if let _ = other as? Cat {
      print("æ±ª~")
    } else {
      print("ç‹—å¾ˆéª„å‚²ï¼Œä¸ä¼šåƒå…¶ä»–åŠ¨ç‰©æ‰“æ‹›å‘¼!")
    }
  }
}

```

é¦–å…ˆç†æ¸…è¿™é“é¢˜ç›®çš„åŸºæœ¬é€»è¾‘ï¼Œæœ‰ 2 ä¸ªåè®®ï¼Œåˆ†åˆ«æ˜¯ Food å’Œ Animalï¼Œç„¶åä¸¤ä¸ªç»“æ„ä½“ fish å’Œ bone åˆ†åˆ«æœä» food åè®®ï¼Œcat å’Œ dog åˆ†åˆ«æœä» animal åè®®ã€‚

å¦‚æœä½ æ­£åœ¨è·³æ§½æˆ–è€…æ­£å‡†å¤‡è·³æ§½ä¸å¦¨åŠ¨åŠ¨å°æ‰‹ï¼Œæ·»åŠ ä¸€ä¸‹å’±ä»¬çš„äº¤æµç¾¤[**101 295 1431**](https://jq.qq.com/?_wv=1027&k=SSQAVXir)æ¥è·å–ä¸€ä»½è¯¦ç»†çš„å¤§å‚é¢è¯•èµ„æ–™ä¸ºä½ çš„è·³æ§½å¤šæ·»ä¸€ä»½ä¿éšœã€‚


å…¶ä¸­åˆæœ‰ä¸¤ä¸ªæ–¹æ³•ä¸º eat å’Œ greetï¼Œæˆ‘ä»¬å‘ç°åˆ†åˆ«åœ¨ cat å’Œ dog ä¸­ï¼Œeat æ–¹æ³•æœ‰å¯¹åº”ç±»å‹çš„å‚æ•°ï¼ŒåŒæ—¶ greet ä¹Ÿå¯¹åº”ç±»å‹çš„å‚æ•°ã€‚æ‰€ä»¥å‡å¦‚ cat å’Œ dog ä¸­èƒ½åœ¨æœä» Animal åè®®çš„åŒæ—¶ï¼Œåˆå†™å‡ºå¯¹åº”è‡ªå·±ç±»å‹çš„å‡½æ•°ï¼Œé‚£å°±å¯ä»¥çœæ‰ if else è¿™ç±»åˆ¤æ–­äº†ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š

```
struct Dog: Animal {
  func eat(food: Bone) {}
  func greet(other: Dog) { print("æ±ª~") }
}

struct Cat: Animal {
  func eat(food: Fish) {}
  func greet(other: Cat) { print("å–µ~") }
}

```

å¾ˆé—æ†¾ç›´æ¥å†™æˆè¿™æ ·ï¼Œç¨‹åºæ˜¯é€šä¸è¿‡ç¼–è¯‘çš„ï¼ŒXcode ä¼šæç¤ºï¼ŒCat å’Œ Dog æ²¡æœ‰æœä» Animal åè®®ï¼Œå› ä¸ºåè®®ä¸­è¦æ±‚çš„ food å¿…é¡»æ˜¯ Foodï¼Œä¸èƒ½æ˜¯ Bone æˆ–è€… Fish ï¼ŒåŒç† greet ä¹Ÿæ˜¯åŒæ ·è¦æ±‚ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ Self å’Œå…³è”ç±»å‹å»æ”¹è¿› Animal åè®®ï¼Œè¿™æ · Cat å’Œ Dog è¿™æ ·å†™å°±æ²¡é—®é¢˜äº†ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
protocol Animal {
  associatedtype FoodType: Food

  func greet(other: Self)
  func eat(food: FoodType)
}

```

Self ç›¸å½“äºæ˜¯ protocol çš„å ä½ç¬¦ï¼Œå®ƒè¡¨ç¤ºä»»æ„åªè¦æ»¡è¶³ Animal çš„ç±»å‹çš†å¯ã€‚associatedType å°±æ˜¯å…³è”ç±»å‹ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç±»å‹çš„å ä½ç¬¦ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥è®© Dog å’Œ Cat æ¥æŒ‡å®š FoodType åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹ã€‚è€Œæ ¹æ® greet æ–¹æ³•ä¸­å¯¹ FoodType çš„ä½¿ç”¨ï¼ŒSwift å¯ä»¥è‡ªåŠ¨æ¨æ–­ï¼ŒFoodType åœ¨ Cat ä¸­æ˜¯ Fishï¼Œåœ¨ Dog ä¸­æ˜¯ Boneã€‚

### 6.è¯•ç”¨ Swift å®ç°äºŒåˆ†æœç´¢ç®—æ³•

**å…³é”®è¯ï¼š#Self #æ³›å‹**

é¦–å…ˆè¦å®¡é¢˜ï¼ŒäºŒåˆ†æœç´¢ç®—æ³•ï¼Œé‚£ä¹ˆè¾“å…¥çš„å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯æ•´å‹æ•°ç»„è¿˜æ˜¯æµ®ç‚¹å‹æ•°ç»„ï¼Ÿå¦‚æœè¾“å…¥ä¸æ˜¯æ’åºè¿‡çš„æ•°ç»„è¯¥å¦‚ä½•æŠ›å‡ºå¼‚å¸¸ï¼Ÿè¿™äº›éƒ½æ˜¯è¦åœ¨å†™ç­”æ¡ˆä¹‹å‰ä¸é¢è¯•å®˜æ¢è®¨çš„é—®é¢˜ã€‚

æˆ‘ä»¬å…ˆæ¥çƒ­ä¸ªèº«ï¼Œå‡å¦‚é¢è¯•å®˜è¦æ±‚å†™å‡ºå¯¹äºæ•´å‹æ’åºæ•°ç»„çš„äºŒåˆ†æœç´¢ç®—æ³•ï¼Œåˆ™ä»£ç å¦‚ä¸‹ï¼š

```
func binarySearch(sortedElements: [Int], for element: Int) -> Bool {
  var lo = 0, hi = sortedElements.count - 1

  while lo <= hi {
    let mid = lo + (hi - lo) / 2
    if sortedElements[mid] == element {
      return true
    } else if sortedElements[mid] < element {
      lo = mid + 1
    } else {
      hi = mid - 1
    }
  }

  return false
}

```

å¦‚æœä½ æ­£åœ¨è·³æ§½æˆ–è€…æ­£å‡†å¤‡è·³æ§½ä¸å¦¨åŠ¨åŠ¨å°æ‰‹ï¼Œæ·»åŠ ä¸€ä¸‹å’±ä»¬çš„äº¤æµç¾¤[**101 295 1431**](https://jq.qq.com/?_wv=1027&k=SSQAVXir)æ¥è·å–ä¸€ä»½è¯¦ç»†çš„å¤§å‚é¢è¯•èµ„æ–™ä¸ºä½ çš„è·³æ§½å¤šæ·»ä¸€ä»½ä¿éšœã€‚


ä¸Šé¢çš„æ–¹æ³•å®Œæˆäº†é¢è¯•å®˜çš„è¦æ±‚ï¼Œä½†æ˜¯æœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œè¿™ä¸ªæ–¹æ³•åªé€‚ç”¨äºæ•´å‹æ•°ç»„ï¼›å…¶æ¬¡ï¼Œè™½ç„¶å˜é‡åä¸º sortedElementsï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•ä¿è¯è¾“å…¥çš„æ•°ç»„å°±ä¸€å®šæ˜¯æŒ‰åºæ’åˆ—çš„ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ç”¨é¢å‘åè®®çš„ç¼–ç¨‹æ¥å®ç°äºŒåˆ†æ³•ï¼š

```
extension Array where Element: Comparable {
  public var isSorted: Bool {

    var previousIndex = startIndex
    var currentIndex = startIndex + 1

    while currentIndex != endIndex {
      if self[previousIndex] > self[currentIndex] {
        return false
      }

      previousIndex = currentIndex
      currentIndex = currentIndex + 1
    }

    return true
  }
}

func binarySearch<T: Comparable>(sortedElements: [T], for element: T) -> Bool {
  // ç¡®ä¿è¾“å…¥æ•°ç»„æ˜¯æŒ‰åºæ’åˆ—çš„
  assert(sortedElements.isSorted)

  var lo = 0, hi = sortedElements.count - 1

  while lo <= hi {
    let mid = lo + (hi - lo) / 2

    if sortedElements[mid] == element {
      return true
    } else if sortedElements[mid] < element {
      lo = mid + 1
    } else {
      hi = mid - 1
    }
  }

  return false
}

```

ä¸Šé¢è§£æ³•é¦–å…ˆåœ¨ Array çš„æ‰©å±•ä¸­åŠ å…¥äº†æ–°å˜é‡ isSorted ç”¨äºåˆ¤æ–­è¾“å…¥çš„æ•°ç»„æ˜¯å¦æŒ‰åºæ’åˆ—ã€‚ä¹‹ååœ¨ binarySearch çš„æ–¹æ³•ä¸­è¿ç”¨äº†æ³›å‹ï¼Œä¿è¯å…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½éµå¾ª Comparable åè®®ï¼Œå¹¶ä¸”æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªç±»å‹ã€‚æœ‰äº†ä¸Šé¢çš„å†™æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†äºŒåˆ†æœç´¢æ³•è¿ç”¨åˆ°å„ç§ç±»å‹çš„æ•°ç»„ä¸­ï¼Œçµæ´»æ€§å¤§å¤§æé«˜ï¼Œä¾‹å¦‚ï¼š

```
binarySearch(sortedElements: [1,4,7], for: 4)            // true
binarySearch(sortedElements: [1.0,3.2,9.23], for: 3.2)   // true
binarySearch(sortedElements: ["1","2","3"], for: "4")    // false
binarySearch(sortedElements: ["4","2","3"], for: "4")    // assert failure

```

å½“ç„¶ï¼Œä¸Šé¢æ–¹æ³•è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ä¾‹å¦‚ Array çš„æ‰©å±•å¯ä»¥æ”¾åˆ° Collection ä¹‹ä¸­ï¼›isSorted å¯ä»¥æ¥å—æ•°å­¦ç¬¦å·è¿›è¡Œæ­£åå‘æ’åºæŸ¥è¯¢ï¼›binarySearch æ–¹æ³•å¯ä»¥ç›´æ¥å†™åˆ° Collection çš„æ‰©å±•ä¸­è¿›è¡Œè°ƒç”¨ã€‚æ€»ä¹‹ï¼Œè¿ç”¨ POP çš„æ€è·¯ï¼Œå¯ä»¥å†™å‡ºä¸¥è°¨ã€çµæ´»çš„ä»£ç ï¼Œå…¶å®ç”¨æ€§å’Œå¯è¯»æ€§ä¹Ÿéå¸¸ä¹‹å¥½ã€‚
# æ¨èğŸ‘‡ï¼š

å¦‚æœä½ æ­£åœ¨è·³æ§½æˆ–è€…æ­£å‡†å¤‡è·³æ§½ä¸å¦¨åŠ¨åŠ¨å°æ‰‹ï¼Œæ·»åŠ ä¸€ä¸‹å’±ä»¬çš„äº¤æµç¾¤[**931 542 608**](https://jq.qq.com/?_wv=1027&k=cfVxrMAH)æ¥è·å–ä¸€ä»½è¯¦ç»†çš„å¤§å‚é¢è¯•èµ„æ–™ä¸ºä½ çš„è·³æ§½å¤šæ·»ä¸€ä»½ä¿éšœã€‚

![](https://upload-images.jianshu.io/upload_images/22877992-0bfc037cc50cae7d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
